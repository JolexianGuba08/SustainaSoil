{% extends 'base.html' %}
{% load static %}

{% block title %} Plant Profile | SustainAsoil {% endblock %}

{% block greenery %}
    <li
            class="bg-secondary text-accent1 p-3 rounded-lg text-center max-xl:flex max-xl:justify-center"
    >
{% endblock %}


{% block content %}
    <!-- Main -->
    <main

            class="flex flex-grow flex-col items-center max-[450px]:mt-10 z-30 max-xl:ml-[80px] ml-[285px] max-[450px]:ml-0 max-[450px]:z-40"
    >
        <!-- Header -->
        <header
                class="bg-secondary px-2 items-center flex justify-between z-50 max-[450px]:w-full max-[450px]:hidden max-[450px]:mb-2 max-[450px]:rounded-none max-[450px]:bg-transparent mt-[2%] w-[90%] p-1 rounded-full mb-7 max-sm:flex max-sm:justify-center"
        >
            <!-- Back Redirect to Greenery & DISPLAY PLANT NAME -->
            <h1
                    class="max-[450px]:text-lg max-[450px]:font-bold max-[450px]:tracking-[1px] text-accent1 font-light tracking-[3px] text-md bg-background flex items-center p-3 px-5 rounded-full max-sm:w-full max-sm:text-center"
            >
                {% if take_cared %}
                <a href="{% url 'add_plant' package_key %}" class="flex">
                {% else  %}
                <a href="{% url 'presets' package_key %}" class="flex">
                {% endif %}

                    <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                            class="w-6 h-6 text-background bg-accent1 p-1 rounded-full"
                    >
                        <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M15.75 19.5 8.25 12l7.5-7.5"
                        />
                    </svg>
                {% if take_cared %}
                    &nbsp{{ plants.plant_name }}
                {% else  %}
                    &nbsp<span>Presets</span>
                {% endif %}

                </a>
            </h1>
            <!-- End Back Redirect to Greenery & DISPLAY PLANT NAME -->

            <!-- Include Notification -->
            {% include 'web_notification.html' %}
        </header>
        <!-- End Header -->

        <div class="hidden" id="websocketData" data-packagekey="{{ package_key }} " data-plantid="{{ plants.plant_id }}"></div>
        <!-- Plant Profile Section -->
        <section class="plant_profile w-[80%] max-lg:w-[90%] max-lg:mb-8">
            {% include 'greenery_page/include_plant_profile/plant_profile_section.html' %}
        </section>

        <!-- Preference Section -->
        <section

                class="w-[80%] h-full mb-[2%] flex max-lg:flex-col max-sm:mb-10 max-pc:mt-10"
        >
            <!-- Set Preference -->
            <div class="s_preference w-[250px] flex flex-col">
                <h2
                        class="flex indent-1 text-xl text-accent1 items-center tracking-widest mt-28 max-lg:mt-3 font-extralight"
                >
                    <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                            class="w-6 h-6"
                    >
                        <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"
                        />
                        <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
                        />
                    </svg>
                    PREFERENCE
                </h2>

                <div class="w-full flex items-center mt-8 max-lg:mb-8">
                    <ul
                            class="font-extralight tracking-widest ml-7 max-[450px]:ml-0 text-accent2 max-lg:flex max-lg:justify-center max-lg:items-center">
                        <li class="w-full rounded-lg cursor-pointer max-xl:mr-5">
                            <button
                                    id="parameter_button"
                                    class="pref_active tracking-wide w-full p-2 px-5 rounded-lg">
                                PARAMETER
                            </button>
                        </li>
                        <li
                                class="mt-3 max-lg:mt-0 hover:bg-secondary rounded-lg transition-colors ease-in-out duration-500 cursor-pointer">
                            {% if take_cared %}
                                <button id="schedule_button" class="w-full p-2 px-5 tracking-wide rounded-lg">
                                    SCHEDULE
                                </button>
                            {% endif %}
                        </li>
                    </ul>
                </div>
            </div>
            <!-- End  Set Preference -->

            <!-- Content Preference  -->
            <div
                    class="c_preference flex-1 flex justify-center items-center flex-grow max-lg:mt-3"
            >
                <div
                        class="cont bg-secondary flex flex-col flex-grow relative rounded-[50px] max-sm:rounded-3xl w-[100%] m-h-[85%] max-lg:h-full p-5 py-6 pc:py-7 shadow-lg"
                >
                    <!-- Heading -->
                    <div class="flex items-center">
                        <img
                                src="{% static 'images/logo-secondary.png' %}"
                                alt="Logo"
                                class="w-[80px] h-[80px] max-sm:w-[70px] max-sm:h-[70px] max-2xl:w-[70px] max-2xl:h-[70px]"
                        />

                        <div class="ml-2">
                            <p class="tracking-[5px] text-accent2 text-md">CARE</p>
                            <h2
                                    class="tracking-[5px] text-accent1 max-2xl:text-md font-extrabold max-[450px]:text-[25px] text-3xl max-sm:text-md"
                            >
                                GREENERY
                            </h2>
                        </div>
                    </div>
                    <!-- End Heading -->

                    <!-- Parameter Form -->
                    {% include 'greenery_page/include_plant_profile/parameter_form.html' %}
                    <!-- End Parameter Form -->

                    <!-- Schedule form -->
                    {% if take_cared %}
                        {% include 'greenery_page/include_plant_profile/schedule_form.html' %}
                    {% endif %}
                    <!-- End Schedule form -->

                </div>
            </div>
            <!-- End Content Preference  -->
        </section>
        <!-- End Preference Section -->
    </main>
    <!-- End Main -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <script>

        const socket = new WebSocket('ws://127.0.0.1:8000/ws/real_time_data/');
        const package_key = $("#websocketData").data("packagekey");
        // Connection opened event handler
        socket.addEventListener('open', (event) => {
            console.log('WebSocket connection opened:', event);

            // Send a message to the server (replace 'your_package_key' with the actual package key)
            socket.send(JSON.stringify({ 'package_key': package_key }));
        });

        // Message received event handler
        socket.addEventListener('message', (event) => {
        const data = JSON.parse(event.data);

        $("#displayMoisture").text(data.message.soil_moist_sensor + "%");
        $("#displayTemperature").text(data.message.temperature_sensor + "Â°C");
        $("#displayHumidity").text(data.message.humidity_sensor + "%");

        if (data.message.soil_moist_sensor === false) {
            $("#displayMoisture").css({
            "color": "red",
            "font-size": "smaller", // Set the font size for error messages
        }).text("No Data");

        }

        if (data.message.temperature_sensor === false) {
            $("#displayTemperature").css({
            "color": "red",
            "font-size": "smaller", // Set the font size for error messages
        }).text("No Data");

        }

        if (data.message.humidity_sensor === false) {
            $("#displayHumidity").css({
            "color": "red",
            "font-size": "smaller", // Set the font size for error messages
        }).text("No Data");

        }

        });


        // Connection closed event handler
        socket.addEventListener('close', (event) => {
            console.log('WebSocket connection closed:', event);
        });

        // Error event handler
        socket.addEventListener('error', (event) => {
            console.error('WebSocket error:', event);
        });
    </script>

    <script>

        $('#set_default_parameter').on('click', function (event) {
            event.preventDefault();
            $(this).prop('disabled', true);
            const package_key = $(this).data('package_key');
            const plant_id = $(this).data('plant_id');
            console.log(package_key, plant_id)
            var data = {
                'package_key': package_key,
                'plant_id': plant_id,
                'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val(),  // Include the CSRF token
            }
            $.ajax({
                type: 'POST',
                url: '{% url 'set_default_values' %}',
                headers: {'X-CSRFToken': data.csrfmiddlewaretoken},  // Set the CSRF token in headers
                data: data,
                success: function (data) {
                    var message = data.message
                    alert(message)
                    window.location.href = '/plant_profile/' + package_key + '/' + plant_id;
                },
                error: function (error) {
                    console.error('Error:', error);
                },
                complete: function () {
                    // Re-enable the button after the AJAX request is completed
                    $('#set_default_parameters').prop('disabled', false);
                }
            });
        });

       function validateScheduleInput(am_pm_id, days_checked_id, hrs_input_id, mins_input_id, schedule_type) {

            const dynamic_dict = {
                'isValid': false,
                'am_pm_value': undefined,
                'selected_days': [],
                'hour_input': undefined,
                'minutes_input': undefined,
                'schedule_type': schedule_type,
            };


            const am_pm_value = $(`input[name="${am_pm_id}"]:checked`).val();

           $('input[name=' + days_checked_id + ']:checked').each(function () {
                dynamic_dict.selected_days.push($(this).val());
            });
            const hrs_input = $(`#${hrs_input_id}`).val();
            const mins_input = $(`#${mins_input_id}`).val();

            if (hrs_input === "" || mins_input === "") {
                alert("Please fill in all the fields");

            }
            else if (isNaN(hrs_input) || isNaN(mins_input)) {
                alert("Please enter valid numeric values for hours and minutes");
            }
            else {
                if (hrs_input > 12 || hrs_input < 1) {
                    alert("Please enter a valid hour");
                } else {
                    if (mins_input > 59 || mins_input < 0) {
                        alert("Please enter a valid minute");
                    } else {
                        if (am_pm_value === undefined) {
                            alert("Please select AM or PM");
                        } else {
                            dynamic_dict.isValid= true;
                            dynamic_dict.am_pm_value = am_pm_value;


                            dynamic_dict.hour_input = hrs_input;
                            dynamic_dict.minutes_input = mins_input;
                        }
                    }
                }
            }

            return dynamic_dict;
        }

        // Function to update the range input based on the selected radio button
        function minTemp(value) {
            $("#min_temperature_level").text(value + "%");
        }

        // Event listener for radio buttons
        $("#plant_min_temp_radio").on("change", function () {
            var selectedValue = $("#plant_min_temp_radio").val();
            if (selectedValue !== undefined) {
                $("#min_temperature_level").text(selectedValue + "%");
            }
        });

        function maxTemp(value) {
            $("#max_temperature_level").text(value + "%");
        }

        // Event listener for radio buttons
        $("#plant_max_temp_radio").on("change", function () {
            var selectedValue = $("#plant_max_temp_radio").val();
            if (selectedValue !== undefined) {
                $("#max_temperature_level").text(selectedValue + "%");
            }
        });


        function minMoisture(value) {
            $("#min_moisture_level").text(value + "%");
        }

        // Event listener for radio buttons
        $("#plant_min_mois_radio").on("change", function () {
            var selectedValue = $("#plant_min_mois_radio").val();
            if (selectedValue !== undefined) {
                $("#min_moisture_level").text(selectedValue + "%");
            }
        });


        function maxMoisture(value) {
            $("#max_moisture_level_display").text(value + "%");
        }

        // Event listener for radio buttons
        $("#plant_max_mois_radio").on("change", function () {
            var selectedValue = $("#plant_max_mois_radio").val();
            if (selectedValue !== undefined) {
                $("#max_moisture_level_display").text(selectedValue + "%");
            }
        });


        $("#parameter_button").on("click", function () {
            $("#schedule_button").removeClass("pref_active");
            $("#parameter_button").addClass("pref_active");
            $("#parameter_section").removeClass("hidden");
            $("#schedule_section").addClass("hidden");
        });


        $("#schedule_button").on("click", function () {
            $("#schedule_button").addClass("pref_active");
            $("#parameter_button").removeClass("pref_active");
            $("#schedule_section").removeClass("hidden");
            $("#parameter_section").addClass("hidden");
        });


        $('#takeCareBttn').on('click', function (event) {
            event.preventDefault();
            $(this).prop('disabled', true);
            const package_key = $(this).data('package_key');
            const plant_id = $(this).data('plant_id');
            console.log(package_key, plant_id)
            var data = {
                'package_key': package_key,
                'plant_id': plant_id,
                'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val(),  // Include the CSRF token
            }
            $.ajax({
                type: 'POST',
                url: '{% url 'take_care_plant' %}',
                headers: {'X-CSRFToken': data.csrfmiddlewaretoken},  // Set the CSRF token in headers
                data: data,
                success: function (data) {
                    var message = data.message
                    alert(message)
                    window.location.href = '/add_plant/' + package_key;
                },
                error: function (error) {
                    console.error('Error:', error);
                },
                complete: function () {
                    // Re-enable the button after the AJAX request is completed
                    $('#takeCareBttn').prop('disabled', false);
                }
            });
        });

        $('#parameter_save').on('click', function (event) {
            event.preventDefault();
            $(this).prop('disabled', true);
            const package_key = $(this).data('package_key');
            const plant_id = $(this).data('plant_id');
            const min_temp = $("#plant_min_temp_radio").val();
            const max_temp = $("#plant_max_temp_radio").val();
            const min_mois = $("#plant_min_mois_radio").val();
            const max_mois = $("#plant_max_mois_radio").val();
            console.log(package_key, plant_id, min_temp, max_temp, min_mois, max_mois)
            var data = {
                'package_key': package_key,
                'plant_id': plant_id,
                'min_temp': min_temp,
                'max_temp': max_temp,
                'min_moist': min_mois,
                'max_moist': max_mois,
                'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val(),
            }
            $.ajax({
                type: 'POST',
                url: '{% url 'update_acc_preferences' %}',
                headers: {'X-CSRFToken': data.csrfmiddlewaretoken},
                data: data,
                success: function (data) {
                    var message = data.message
                    alert(message)

                },
                error: function (error) {
                    console.error('Error:', error);
                },
                complete: function () {
                    // Re-enable the button after the AJAX request is completed
                    $('#parameter_save').prop('disabled', false);
                }
            });
        });

        $('#set_water_schedule').on('click', function (event) {
        event.preventDefault();

        var results = validateScheduleInput("am/pm_water", "days_checked", "hrs_input_water", "mins_input_water","watering");

        var data = {
            'am_pm_value': results.am_pm_value,
            'selected_days': JSON.stringify(results.selected_days),
            'hour_input': results.hour_input,
            'minutes_input': results.minutes_input,
            'schedule_type': results.schedule_type,
            'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val(),
        }
        if (results.isValid === true)
        {
            $('#set_water_schedule').prop('disabled', true);
            $.ajax({
                type: 'POST',
                url: '{% url 'water_scheduling' package_key=package_key %}',
                headers: {'X-CSRFToken': data.csrfmiddlewaretoken},
                data: data,
                success: function (data) {
                   if (data.status === "error"){
                       alert(data.message)
                        window.location.reload()
                    }
                   else {
                        alert(data.message)
                    }


                },
                error: function (error) {
                    console.error('Error:', error);
                    window.location.reload()
                },
                complete: function () {
                    // Re-enable the button after the AJAX request is completed
                    $('#set_water_schedule').prop('disabled', false);
                }
            });

        }

        });

        $('#set_pesticide_schedule').on('click', function (event) {
        event.preventDefault();

        var results = validateScheduleInput("am_pm_pesc", "days_checked_pesc", "hrs_input_pesticide", "mins_input_pesticide","pesticide");

        var data = {
            'am_pm_value': results.am_pm_value,
            'selected_days': JSON.stringify(results.selected_days),
            'hour_input': results.hour_input,
            'minutes_input': results.minutes_input,
            'schedule_type': results.schedule_type,
            'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val(),
        }
        if (results.isValid === true)
        {
            $('#set_pesticide_schedule').prop('disabled', true);
            $.ajax({
                type: 'POST',
                url: '{% url 'water_scheduling' package_key=package_key %}',
                headers: {'X-CSRFToken': data.csrfmiddlewaretoken},
                data: data,
                success: function (data) {
                       if (data.status === "error"){
                       alert(data.message)
                        window.location.reload()
                    }
                   else {
                        alert(data.message)
                    }
                },
                error: function (error) {
                    console.error('Error:', error);
                    window.location.reload()
                },
                complete: function () {
                    // Re-enable the button after the AJAX request is completed
                    $('#set_pesticide_schedule').prop('disabled', false);
                }
            });

        }

        });

        $('#turn_on_water_sched').on('click', function (event) {
          event.preventDefault();

            var results = validateScheduleInput("am/pm_water", "days_checked", "hrs_input_water", "mins_input_water","watering");

            var data = {
                'isSchedule': $(this).val(),
                'schedule_type': results.schedule_type,
                'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val(),
            }
            console.log(data)
            if (results.isValid === true)
            {

                $.ajax({
                    type: 'POST',
                    url: '{% url 'schedule_on_off' package_key=package_key %}',
                    headers: {'X-CSRFToken': data.csrfmiddlewaretoken},
                    data: data,
                    success: function (data) {
                        console.log(data)
                       if (data.status === "error"){
                           alert(data.message)
                            window.location.reload()
                        }
                       else {
                            alert(data.message)
                        }


                    },
                    error: function (error) {
                        console.error('Error:', error);
                        window.location.reload()
                    },
                    complete: function () {
                        if  (data.isSchedule === "true"){
                            $("#turn_on_water_sched").text("Turn off Schedule");
                            $("#turn_on_water_sched").val(false);
                        }
                        else{
                            $("#turn_on_water_sched").text("Turn on Schedule");
                            $("#turn_on_water_sched").val(true);
                        }

                    }
                });

            }

            });

        $('#turn_on_pesc_sched').on('click', function (event) {
          event.preventDefault();
            var results = validateScheduleInput("am_pm_pesc", "days_checked_pesc", "hrs_input_pesticide", "mins_input_pesticide","pesticide");


            var data = {
                'isSchedule': $(this).val(),
                'schedule_type': results.schedule_type,
                'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val(),
            }
            console.log(data)
            if (results.isValid === true)
            {

                $.ajax({
                    type: 'POST',
                    url: '{% url 'schedule_on_off' package_key=package_key %}',
                    headers: {'X-CSRFToken': data.csrfmiddlewaretoken},
                    data: data,
                    success: function (data) {
                        console.log(data)
                       if (data.status === "error"){
                           alert(data.message)
                            window.location.reload()
                        }
                       else {
                            alert(data.message)
                        }


                    },
                    error: function (error) {
                        console.error('Error:', error);
                        window.location.reload()
                    },
                    complete: function () {
                        if (data.isSchedule === "true"){
                            $("#turn_on_pesc_sched").text("Turn off Schedule");
                            $("#turn_on_pesc_sched").val(false);
                        }
                        else{
                            $("#turn_on_pesc_sched").text("Turn on Schedule");
                            $("#turn_on_pesc_sched").val(true);
                        }
                    }
                });

            }

            });

        $('#water_reset').on('click', function (event) {
          event.preventDefault();

            var data = {

                'schedule_type': 'watering',
                'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val(),
            }
           var result = confirm("Do you want to reset?");


            if (result) {
                $.ajax({
                    type: 'POST',
                    url: '{% url 'schedule_reset' package_key=package_key %}',
                    headers: {'X-CSRFToken': data.csrfmiddlewaretoken},
                    data: data,
                    success: function (data) {
                        console.log(data)
                       if (data.status === "error"){
                           alert(data.message)
                            window.location.reload()
                        }
                       else {
                            alert(data.message)
                            window.location.reload()
                        }


                    },
                    error: function (error) {
                        console.error('Error:', error);
                        window.location.reload()
                    },
                    complete: function () {

                    }
                });
            } else {
                return  false;
            }

        });

         $('#pesc_reset').on('click', function (event) {
          event.preventDefault();

            var data = {

                'schedule_type': 'pesticide',
                'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val(),
            }
           var result = confirm("Do you want to reset?");


            if (result) {
                $.ajax({
                    type: 'POST',
                    url: '{% url 'schedule_reset' package_key=package_key %}',
                    headers: {'X-CSRFToken': data.csrfmiddlewaretoken},
                    data: data,
                    success: function (data) {
                        console.log(data)
                       if (data.status === "error"){
                           alert(data.message)
                            window.location.reload()
                        }
                       else {
                            alert(data.message)
                            window.location.reload()
                        }


                    },
                    error: function (error) {
                        console.error('Error:', error);
                        window.location.reload()
                    },
                    complete: function () {

                    }
                });
            } else {
                return  false;
            }

        });

       {% autoescape off %}
            $(document).ready(function() {
                water_data = {{ water_data|safe }};

                // Set Schedule for water

                var hrs_input_water = $("#hrs_input_water");
                var mins_input_water = $("#mins_input_water");


                if (water_data.hours_value === 0 || water_data.minutes_value === 0) {

                    hrs_input_water.val("");
                    mins_input_water.val("");

                }
                else{

                    hrs_input_water.val(water_data.hours_value);
                    mins_input_water.val(water_data.minutes_value);
                }

                 if (water_data['is_Schedule'] === 'true') {
                     $("#turn_on_water_sched").text("Turn off Schedule");
                     $("#turn_on_water_sched").val(false);


                 }
                else{

                    $("#turn_on_water_sched").text("Turn on Schedule");
                    $("#turn_on_water_sched").val(true);

                }


                var selectedAmPmWater = water_data.am_pm_value;

                if (selectedAmPmWater === "") {
                    // If undefined, uncheck both AM and PM radio buttons
                    $('input[name="am/pm_water"]').prop('checked', false);
                } else {
                    // If defined, check the corresponding radio button
                    $('input[name="am/pm_water"]').filter('[value="' + selectedAmPmWater + '"]').prop('checked', true);
                }
                var daysCheckboxes_water = document.getElementsByName("days_checked");

                daysCheckboxes_water.forEach((checkbox) => {
                    const dayValue = checkbox.value;
                    checkbox.checked = water_data[dayValue] === 'true'; // Assuming 'true' or 'false' strings
                });

                // PESTICIDE SECTION

                pesc_data = {{ pesc_data|safe }};
                // Similarly, set Schedule for pesticide
                var hrs_input_pesc = $("#hrs_input_pesticide");
                var mins_input_pesc = $("#mins_input_pesticide");

                if (pesc_data["isSchedule"] === 'true'){
                    $("#turn_on_pesc_sched").text("Turn off Schedule");
                    $("#turn_on_pesc_sched").val(false);

                }
                else{
                    $("#turn_on_pesc_sched").text("Turn on Schedule");
                    $("#turn_on_pesc_sched").val(true);

                }
                // Set hours and minutes for pesticide

                if (pesc_data.hours_value === 0 || pesc_data.minutes_value === 0) {

                    hrs_input_pesc.val("");
                    mins_input_pesc.val("");

                }
                else{

                    hrs_input_pesc.val(pesc_data.hours_value);
                    mins_input_pesc.val(pesc_data.minutes_value);
                }

                var selectedAmPmPesc = pesc_data.am_pm_value;

                if (selectedAmPmPesc === "") {
                    // If undefined, uncheck both AM and PM radio buttons
                    $('input[name="am_pm_pesc"]').prop('checked', false);
                } else {
                    // If defined, check the corresponding radio button
                    $('input[name="am_pm_pesc"]').filter('[value="' + selectedAmPmPesc + '"]').prop('checked', true);
                }
                var daysCheckboxes_pesc = document.getElementsByName("days_checked_pesc");


                // Set days checkboxes for pesticide
                daysCheckboxes_pesc.forEach(function(checkbox) {
                    var dayValue = checkbox.value;
                    checkbox.checked = pesc_data[dayValue] === 'true';
                });
            });
        {% endautoescape %}
    </script>

{% endblock %}